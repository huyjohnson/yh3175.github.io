<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Personal Quantification Project</title>
    <script type="text/javascript" src="../d3.js"></script>
    <link rel="stylesheet" href="styles_quant.css">
    <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet'>
  </head>
  <body>
    <header>
      <p class="hd_title">Number of times my phonescreen lights up</p>
      <p class="hd_name">Jacob Hu</p><br><br>
    </header>
    <script type="text/javascript">

      // Width, height, margins
      var w = 1800;
      var h = 550;
      var margin = ({top: 40, right: 120, bottom: 40, left:120});
      var bar_w = 13;

      // Empty variables for now
      var dataset, xScale, yScaleC, yScale, xAxis, yAxisC, yAxisS;

      // For converting strings to dates
      var parseTime = d3.timeParse("%m/%d/%Y");

      // For converting dates to strings
      var formatTime = d3.timeFormat("%e");

      // Function for converting CSV values from strings to numbers
      var rowConverter = function(d) {
        return {
          Date: parseTime(d.pq_date),
          Stotal: parseInt(d.pq_stotal),
          Semail: parseInt(d.pq_semail),
          Sadspam: parseInt(d.pq_sadspam),
          Ssocmed: parseInt(d.pq_ssocmed),
          Scom: parseInt(d.pq_scom),
          Ctotal: parseInt(d.pq_ctotal),
          Cbrowse: parseInt(d.pq_cbrowse),
          Ccom: parseInt(d.pq_ccom),
          Ccheck: parseInt(d.pq_ccheck),
          Day: d.pq_day
        };
      }

      // LOAD DATA
      d3.csv("pers_quant_data.csv", rowConverter)
        .then(function(data) {

          // Copy data into global dataset
          dataset = data;

          // Discover start and end dates in dataset
          var startDate = d3.min(dataset, function(d) {
            return d.Date;
          });

          var endDate = d3.max(dataset, function(d) {
            return d.Date;
          });

          // Create scale functions
          xScale = d3.scaleTime()
                  .domain([
                    d3.timeDay.offset(startDate, -1), // startDate minus one day for padding
                    d3.timeDay.offset(endDate, 1) // endDate plus one day for padding
                  ])
                  .range([margin.right, w - margin.right]);

          yScale = d3.scaleLinear()
                  .domain([
                    0, // zero as baseline
                    d3.max(dataset, function(d) { return d.Stotal + d.Ctotal; })
                  ])
                  .range([0, h - (margin.top * 5)]);

          yScaleS = d3.scaleLinear()
                  .domain([
                    d3.max(dataset, function(d) { return d.Stotal + d.Ctotal; }),
                    0
                  ])
                  .range([0, h - (margin.top * 5)]);

          // Define axes
          yAxisS = d3.axisRight()
            .scale(yScaleS)
            .ticks(5)
            .tickPadding(-(w - (margin.left * 1.8)))
            .tickSize(w - (margin.left * 2))
            .tickValues([5, 10, 15, 20, 25]);

          yAxisC = d3.axisRight()
            .scale(yScale)
            .ticks(5)
            .tickPadding(-(w - (margin.left * 1.8)))
            .tickSize(w - (margin.left * 2))
            .tickValues([0 ,5, 10, 15]);

          xAxis = d3.axisBottom()
            .scale(xScale)
            .ticks(21)
            .tickFormat(d3.timeFormat("%a"))
            .tickPadding(-h/2 - margin.top)
            .tickSize([0]);

          // Create SVG element
          var svg = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);

          // Group bars in nodes
          var nodes = svg.selectAll("rect")
              .data(dataset)
              .enter()
              .append("g")
              .classed("bars", true)
              .attr("stroke-width", 1.7)
              .attr("stroke", "white");

          // Group text together
          var numSTotal = svg.selectAll("text")
              .data(dataset)
              .enter()
              .append("g")
              .attr("class", "Stotal")
              .attr("text-anchor", "middle")
              .attr("font-family", "sans-serif")
              .attr("font-size", "14px")
              .attr("fill", "black")
              .attr("font-weight", "bold");

          var numSmall = svg.selectAll("text")
              .data(dataset)
              .enter()
              .append("g")
              .attr("class", "smallNum")
              .attr("text-anchor", "left")
              .attr("font-family", "sans-serif")
              .attr("font-size", "12px")
              .attr("fill", "black")
              .attr("font-weight", "bold");
          /*
          // Stotal bars - background
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top - yScale(d.Stotal);
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Stotal);
             })
             .attr("fill", "#F2F2F2"); // light grey
             */

          // Semail bars
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top - yScale(d.Semail);
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Semail);
             })
             .attr("fill", "#A7B9C6")
             .on("mouseover", function() {
               d3.selectAll(".semail").style("visibility", "visible");
             })
             .on("mouseout", function() {
               d3.selectAll(".semail").style("visibility", "hidden");
             });

          // Sadspam bars
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top - yScale(d.Sadspam) - yScale(d.Semail);
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Sadspam);
             })
             .attr("fill", "#CAD5DA");

          // Ssocmed bars
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top - yScale(d.Ssocmed)
               - yScale(d.Sadspam) - yScale(d.Semail);
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Ssocmed);
             })
             .attr("fill", "#98A8A7");

          // Scom bars
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top - yScale(d.Ssocmed)
               - yScale(d.Sadspam) - yScale(d.Semail) - yScale(d.Scom);
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Scom);
             })
             .attr("fill", "#D4D5D6");

          /*
          // Ctotal bars - background
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top;
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Ctotal);
             })
             .attr("fill", "#F2F2F2"); // light grey
             */

          // Cbrowse bars
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top;
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Cbrowse);
             })
             .attr("fill", "#D6B7AE");

          // Ccheck bars
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top + yScale(d.Cbrowse);
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Ccheck);
             })
             .attr("fill", "#AAA59F");

          // Ccom bars
          nodes.append("rect")
             .attr("x", function(d) {
               return xScale(d.Date) - bar_w/2;
             })
             .attr("y", function(d) {
               return (h/2) + margin.top + yScale(d.Cbrowse) + yScale(d.Ccheck);
             })
             .attr("width", bar_w)
             .attr("height", function(d) {
               return yScale(d.Ccom);
             })
             .attr("fill", "#C3C6B5");

             // Create text labels on bars
             numSTotal.append("text")
              .text(function(d) {
                return d.Stotal;
              })
              .attr("x", function(d) {
                return xScale(d.Date);
              })
              .attr("y", function(d) {
                return (h/2) + margin.top - yScale(d.Stotal) - 3;
              });

             numSmall.append("text")
              .attr("class", "semail")
              .text(function(d) {
                if (d.Semail > 1) {
                  return d.Semail + " emails";
                } else {
                  return d.Semail + " email";
                }
              })
              .attr("x", function(d) {
                return xScale(d.Date) + 8;
              })
              .attr("y", function(d) {
                return (h/2) + margin.top - yScale(d.Semail) + 11;
              });


         // Create Y axis (S)
         var yAxisSM = svg.append("g")
          .attr("class", "axis")
          .attr("id", "yAxisS")
          .attr("transform", "translate(" + margin.left + "," + (5 - margin.top) + ")")
          .call(yAxisS);

         // Create Y Axis (C)
         var yAxisCM = svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(" + margin.left + "," + (h/2 + margin.top) + ")")
          .call(yAxisC);

         // Create X axis
         var xAxisM = svg.append("g")
           .attr("class", "axis")
           .attr("id", "xAxisG")
           .attr("transform", "translate(0," + ((h/2) + margin.top) + ")")
           .call(xAxis);

        // Remove first and last labels on the x axis
        d3.select("g#xAxisG")
         .select("g.tick")
         .remove();

        d3.select("g#xAxisG")
         .select("g.tick:last-child")
         .remove();



        });
    </script>
  </body>
</html>
